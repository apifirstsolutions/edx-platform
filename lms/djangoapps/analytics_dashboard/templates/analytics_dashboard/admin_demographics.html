## mako

<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%def name="online_help_token()"><% return "profile" %></%def>
<%namespace name='static' file='/static_content.html'/>

<%!
import json
from django.urls import reverse
from django.utils.translation import ugettext as _
from openedx.core.djangolib.js_utils import dump_js_escaped_json
from openedx.core.djangolib.markup import HTML
%>

<%block name="pagetitle">${_("Learner Profile")}</%block>

<%block name="bodyclass">view-profile</%block>

<%block name="headextra">
<%static:css group='style-course'/>
</%block>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
      crossorigin="anonymous">

<div class="container-fluid">
    <div class="row">
        <!-- Side Navigation Bar -->
        ##{% include 'admin_dashboard_nav.html' %}

                <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse" style="">
            <button class="navbar-toggler position-absolute d-md-none collapsed" type="button"data-bs-toggle="collapse"
                data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="${ reverse('analytics_dashboard:admin_dashboard') }">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-home">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a  class="nav-link" href="${ reverse('analytics_dashboard:admin_demographics') }">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-users">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            Demographics
                        </a>
                    </li>
                    ##<li class="nav-item">
                    ##    <a  class="nav-link" href="${ reverse('analytics_dashboard:admin_revenue') }">
                    ##        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    ##            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    ##            stroke-linejoin="round" class="feather feather-users">
                    ##            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    ##            <circle cx="9" cy="7" r="4"></circle>
                    ##            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    ##            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    ##        </svg>
                    ##        Revenue
                    ##    </a>
                    ##</li>
                </ul>
            </div>
        </nav>


        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div
                class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Demographics</h1>
                ##<!-- <div class="btn-toolbar mb-2 mb-md-0 dropdown">
                ##    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" id="dropdownMenuButtonCourse" data-bs-toggle="dropdown" aria-expanded="false">
                ##        <span data-feather="calendar"></span>
                ##        Filter by Course
                ##    </button>
                ##    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonCourse">
                ##        {% for c in courses %}
                ##            <li><a class="dropdown-item" href="#">{{ c.display_name }</a></li>
                ##        {% endfor %}
                ##      </ul>
                ##</div> -->
            </div>

            <!-- Cards  -->
            <div class="fluid-container">
                <div class="row mt-2">
                    <h3>Gender</h3>
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6 justify-content-center">
                        <canvas id="myChart" width="500"></canvas>
                    </div>
                    <div class="col-sm-3">
                        <ul class="list-group list-group-flush mt-5">
                            % for c in learners_gender:
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="font-size: smaller;">
                                ${ c['gender'] }
                                <span class="badge badge" style="font-size:small;background-color:#1a345c;">${ c['total'] }</span>
                            </li>
                            % endfor:
                        </ul>
                    </div>
                    <%
                    import json
                    gender = [c['gender'] for c in learners_gender]
                    gender_data = [c['total'] for c in learners_gender]
                    %>
                    <script>

                        var lb = ${json.dumps(gender) | n}
                        var gender_data = ${gender_data}

                        <%text>
                        var ctx = document.getElementById('myChart').getContext('2d')
                        const data = {
                        labels: lb,
                        datasets: [
                            {
                            label: 'Demographics by Gender',
                            data: gender_data,
                            // borderColor: '#1a345c',
                            // backgroundColor: '#1a345c',
                            backgroundColor: [
                                'rgba(49, 107, 196, 0.9)',
                                'rgba(49, 107, 196, 0.7)',
                                'rgba(49, 107, 196, 0.5)',
                                'rgba(49, 107, 196, 0.3)'
                            ],
                            }
                        ]
                        };

                        var myChart = new Chart(ctx, {
                            type: 'pie',
                            data: data,
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                    },
                                    title: {
                                        display: true,
                                        text: 'Demographics by Gender'
                                    }
                                }
                            },
                        })
                        </%text>
                    </script>
                </div>
                <hr>
                <div class="row mt-5">
                    <h3>Education</h3>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-8" >
                        <canvas id="myChartByEducation" height="300" width="500"></canvas>
                    </div>
                    <div class="col-sm-3">
                        <ul class="list-group list-group-flush mt-5">
                            % for c in learners_edu:
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="font-size: smaller;" >
                                ${ c['level_of_education']}
                                <span class="badge badge" style="font-size:small; background-color:#1a345c;">${ c['total'] }</span>
                            </li>
                            % endfor:
                        </ul>
                    </div>
                    <%
                    edu_level_lb = [c['level_of_education'] for c in learners_edu ]
                    edu_level_data = [c['total'] for c in learners_edu]
                    %>
                    <script>
                        var edu_level_lb = ${json.dumps(edu_level_lb) | n}
                        var edu_level_data = ${edu_level_data}

                        <%text>
                        var ctx = document.getElementById('myChartByEducation').getContext('2d')
                        // eslint-disable-next-line no-unused-vars
                        const edu_data = {
                        labels: edu_level_lb,
                        datasets: [
                            {
                            label: '# of learners',
                            data: edu_level_data,
                            // borderColor: '#1a345c',
                            backgroundColor: '#1a345c',
                            // backgroundColor: [
                            //     'rgba(49, 107, 196, 0.9)',
                            //     'rgba(49, 107, 196, 0.7)',
                            //     'rgba(49, 107, 196, 0.5)',
                            //     'rgba(49, 107, 196, 0.3)'
                            // ],
                            }
                        ]
                        };

                        var myChart = new Chart(ctx, {
                            type: 'bar',
                            data: edu_data,
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                    },
                                    title: {
                                        display: true,
                                        text: 'Demographics by Level of Education'
                                    }
                                }
                            },
                        })
                        </%text>
                    </script>
                </div>

                <hr>

                <div class="row mt-5">
                    <h3>Age</h3>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-8" >
                        <canvas id="myChartByAge" height="300" width="500"></canvas>
                    </div>
                    <div class="col-sm-3">
                        <ul class="list-group list-group-flush mt-5">
                            % for k, v in learners_age_list.items():
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="font-size: smaller;">
                                ${ k }
                                <span class="badge badge" style="font-size:small; background-color:#1a345c;">${ v }</span>
                            </li>
                            % endfor:
                        </ul>
                    </div>

                    <div class="row my-5">
                        <!-- Median Learner Age -->
                        <!-- <div class="col-sm-1"></div> -->
                        <div class="col-sm-3 col-md-3">
                            <div class="panel panel-default text-center">
                                <div class="panel-body">
                                    <p class="panel-title text-uppercase text-center" style="font-size: small;">Median Learner Age</p>
                                    <h1 class="panel-text fs-1 text-center">${ age_median }</h1>
                                    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                                </div>
                            </div>
                        </div>

                        <!-- Learner 25 and Under -->
                        <!-- <div class="col-sm-1"></div> -->
                        <div class="col-sm-3 col-md-3">
                            <div class="panel panel-default text-center">
                                <div class="panel-body">
                                    <p class="panel-title text-uppercase text-center" style="font-size: small;">Learner 25 and Under</p>
                                    <h1 class="panel-text fs-1 text-center">${ age_dist['age_lte_25'] } %</h1>
                                    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                                </div>
                            </div>
                        </div>

                        <!-- Learner 26 to 40 -->
                        <!-- <div class="col-sm-1"></div> -->
                        <div class="col-sm-3 col-md-3">
                            <div class="panel panel-default text-center">
                                <div class="panel-body">
                                    <p class="panel-title text-uppercase text-center" style="font-size: small;">Learner 26 to 40</p>
                                    <h1 class="panel-text fs-1 text-center">${ age_dist['age_btw_26_and_40'] } %</h1>
                                    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                                </div>
                            </div>
                        </div>

                        <!-- Courses Completed -->
                        <!-- <div class="col-sm-1"></div> -->
                        <div class="col-sm-3 col-md-3">
                            <div class="panel panel-default text-center">
                                <div class="panel-body">
                                    <p class="panel-title text-uppercase text-center" style="font-size: small;">Learner 41 and Over</p>
                                    <h1 class="panel-text fs-1 text-center">${ age_dist['age_gt_40'] } %</h1>
                                    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <%
                    age_data = [v for k,v in learners_age_list.items()]
                    %>
                    <script>
                        var age_lb = ['<20', '21 - 30', '31 - 40', '41 - 50', '51 - 60', '61 - 70', '>70']
                        ##// var age_lb = [{% for k in learners_age_list %} '${ k|escapejs }', {% endfor %}]
                        ##// var age_data = ${learners_age_list | escapejs}
                        var age_data = ${age_data}
                        <%text>
                        var ctx = document.getElementById('myChartByAge').getContext('2d')

                        const ageData = {
                            labels: age_lb,
                            datasets: [
                                {
                                label: '# of learners',
                                data: age_data,
                                // borderColor: '#1a345c',
                                backgroundColor: '#1a345c',
                                // backgroundColor: [
                                //     'rgba(49, 107, 196, 0.9)',
                                //     'rgba(49, 107, 196, 0.7)',
                                //     'rgba(49, 107, 196, 0.5)',
                                //     'rgba(49, 107, 196, 0.3)'
                                // ],
                                }
                            ]
                        };

                        var myChart = new Chart(ctx, {
                            type: 'bar',
                            data: ageData,
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                    },
                                    title: {
                                        display: true,
                                        text: 'Demographics by Age'
                                    }
                                }
                            },
                        })
                        </%text>
                    </script>
                </div>
            </div>
        </main>
    </div>
</div>

<%block name="js_extra">

</%block>

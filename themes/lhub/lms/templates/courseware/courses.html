<%page expression_filter="h"/>
<%!
  import json
  from django.utils.translation import ugettext as _
  from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
  from django.urls import reverse
%>
<%inherit file="../main.html" />
<%
  course_discovery_enabled = settings.FEATURES.get('ENABLE_COURSE_DISCOVERY')
%>

<%namespace name='static' file='../static_content.html'/>
<link rel="stylesheet" href="/static/lhub/courses.css" type="text/css" media="all">
% if course_discovery_enabled:
<%block name="header_extras">
  % for template_name in ["course_card", "filter_bar", "filter", "facet", "facet_option"]:
  <script type="text/template" id="${template_name}-tpl">
      <%static:include path="discovery/${template_name}.underscore" />
  </script>
  % endfor
  <%static:require_module module_name="js/discovery/discovery_factory" class_name="DiscoveryFactory">
    DiscoveryFactory(
      ${course_discovery_meanings | n, dump_js_escaped_json},
      getParameterByName('search_query'),
      "${user_language | n, js_escaped_string}",
      "${user_timezone | n, js_escaped_string}"
    );
  </%static:require_module>
</%block>
% endif


<%block name="pagetitle">${_("Courses")}</%block>
<div class="selects-wrapper-all">
    <div class="select-wrapper">
        <span class="select-name">${_("Sorting")}</span>
        <select class="js-select-sort">
            <option value="">---</option>
            <option value="rating" ${'selected="selected"' if sort == 'rating' else ''}>
                ${_("Rating from highest to lowest")}
            </option>
            <option value="price" ${'selected="selected"' if sort == 'price' else ''}>
                ${_("Price highest to lowest")}
            </option>
            <option value="latest" ${'selected="selected"' if sort == 'latest' else ''}>
                ${_("Newest to oldest ")}
            </option>
        </select>
    </div>
    <div class="select-wrapper">
        <span class="select-name">${_("Level")}</span>
        <select class="js-select-difficulty-level">
            <option value="">---</option>
            % for difficulty_level in difficulty_levels:
            <option value="${difficulty_level.id}" ${'selected="selected"' if difficulty_level.id == selected_difficulty_level_id else ''}>
                ${difficulty_level.label}
            </option>
            % endfor
        </select>
    </div>
    <div class="select-wrapper">
        <span class="select-name">${_("Payment type")}</span>
        <select class="js-select-mode">
            <option value="">---</option>
            <option value="free" ${'selected="selected"' if selected_mode == 'free' else ''}>
                ${_("Free")}
            </option>
            <option value="paid" ${'selected="selected"' if selected_mode == 'paid' else ''}>
                ${_("Paid")}
            </option>
            <option value="discounted" ${'selected="selected"' if selected_mode == 'discounted' else ''}>
                ${_("Discounted")}
            </option>
        </select>
    </div>
</div>

<main id="main" aria-label="Content" tabindex="-1">
    <section class="find-courses">
      <section class="courses-container">
        % if course_discovery_enabled:
        <div id="discovery-form" role="search" aria-label="course" class="wrapper-search-context">
          <div id="discovery-message" class="search-status-label"></div>
          <form class="wrapper-search-input">
            <label for="discovery-input" class="sr">${_('Search for a course')}</label>
            <input id="discovery-input" class="discovery-input" placeholder="${_('Search for a course')}" type="text"/>
            <button type="submit" class="button postfix discovery-submit" title="${_('Search')}">
              <span class="icon fa fa-search" aria-hidden="true"></span>
              <div aria-live="polite" aria-relevant="all">
                <div id="loading-indicator" class="loading-spinner hidden">
                  <span class="icon fa fa-spinner fa-spin" aria-hidden="true"></span>
                  <span class="sr">${_('Loading')}</span>
                </div>
              </div>
            </button>
          </form>
        </div>

        <div id="filter-bar" class="filters hide-phone is-collapsed">
        </div>
        % endif

<div class="carousel">
   <div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
            <ul class="carousel-indicators">
        % if banner_list:
            % for y in banner_list:
                % if loop.index==1:
                    <li data-target="#myCarousel" data-slide-to="${y.slide_position}" class="active"></li>
                % else:
                    <li data-target="#myCarousel" data-slide-to="${y.slide_position}" ></li>
                % endif
            % endfor
        % endif
            </ul>
            <!-- Wrapper for slides -->
            <div class="carousel-inner">
            % if banner_list:
                % for y in banner_list:
                        % if loop.index==1:
                        <div class="item active" style="height:720px">
                            <a href="${reverse('about_course', args=[str(y.course_over_view.id)])}">
                            <img src="${y.banner_img_url_txt}"  class="d-block w-100 p-0">
                                </a>
                        <div class="carousel-caption">
                            <h4 >${y.course_over_view.display_name_with_default}</h4>
                        </div>
                        </div>
                        % else:
                        <div class="item" style="height:720px">
                             <a href="${reverse('about_course', args=[str(y.course_over_view.id)])}">
                            <img src="${y.banner_img_url_txt}"  class="d-block w-100 p-0">
                             </a>
                        <div class="carousel-caption" >
                            <h3>${y.course_over_view.display_name_with_default}</h3>
                        </div>
                        </div>
                        % endif
                % endfor
            % endif
            </div>

    <!-- Left and right controls -->
    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
      <span class="glyphicon glyphicon-chevron-left"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" data-slide="next">
      <span class="glyphicon glyphicon-chevron-right"></span>
      <span class="sr-only">Next</span>
    </a>

  </div>
</div>
        % if course_discovery_enabled:
        <div id="discovery-form" role="search" aria-label="course" class="wrapper-search-context">
          <div id="discovery-message" class="search-status-label"></div>
          <form class="wrapper-search-input">
            <label for="discovery-input" class="sr">${_('Search for a course')}</label>
            <input id="discovery-input" class="discovery-input" placeholder="${_('Search for a course')}" type="text"/>
            <button type="submit" class="button postfix discovery-submit" title="${_('Search')}">
              <span class="icon fa fa-search" aria-hidden="true"></span>
              <div aria-live="polite" aria-relevant="all">
                <div id="loading-indicator" class="loading-spinner hidden">
                  <span class="icon fa fa-spinner fa-spin" aria-hidden="true"></span>
                  <span class="sr">${_('Loading')}</span>
                </div>
              </div>
            </button>
          </form>
        </div>

        <div id="filter-bar" class="filters hide-phone is-collapsed">
        </div>
        % endif
        %if show_categorized_view == False:
        <div class="courses${'' if course_discovery_enabled else ' no-course-discovery'}" role="region" aria-label="${_('List of Courses')}">

            ## limiting the course number by using HOMEPAGE_COURSE_MAX as the maximum number of courses
              % if course_tag:
                  %for key in course_tag:
                    %for val  in key.items():
                      % for tag in val[1]: # val[0] - category, val[1] - course listing as array in that category
                          % if loop.index == 0 :
                           <ul class="courses-listing" style="margin: 0 0 3px 0;">
                               <li class="courses-listing-item" >
                                   <h3>${val[0]}</h3>
                                   <%include file="../course.html" args="course=tag" />
                               </li>
                          % else:
                              <li class="courses-listing-item" >
                                   %if len(key.items()) > 1:
                                      <h3>&nbsp;</h3>
                                  % endif
                                   <%include file="../course.html" args="course=tag" />
                               </li>

                          % endif
                      %endfor
                                </ul>
                    %endfor
                  %endfor
              %endif

            </div>

          <div class="courses${'' if course_discovery_enabled else ' no-course-discovery'}" role="region" aria-label="${_('List of Courses')}">
            <ul class="courses-listing courses-list">
              %for course in courses:
              <li class="courses-listing-item">
                <%include file="../course.html" args="course=course" />
              </li>
              %endfor
            </ul>
        %else:
              <!--   from here -->
%if user.is_authenticated:
   <section class="card-slider-container">
<input id="user_industry" type="hidden" value="${user_industry}">


      <div class="slider-heading">
      <h2 class="card-slider-title" style="">Recommended Courses for You</h2>
      <a href="#" id="rec_id" = >View All</a>
      </div>
            <div class="card-slider-courses">
            <div class="loader-sec" id = "recommended_courses_loader" style="display:none;">
            <div class="loader"></div>
        </div>
        <div class="card-slider-prev-btn" id = "recommended_prev_btn" style="display:none"><i class="fas fa-chevron-left"></i></div>
         <div id="recommended_next_btn" style="display:none" class=" card-slider-next-btn"><i class="fas fa-chevron-right"></i></div>
         <ul id="recommended_courses_ul" class="card-slider-card-container owl-carousel owl-theme">

         </ul>
      </div>
   </section>
%endif
      <section class="card-slider-container">
      <div class="slider-heading">
      <h2 class="card-slider-title" style="">Most Popular Courses</h2>
      <a href="/courses?sort=enrollments">View All</a>
      </div>



      <div class="card-slider-courses">
            <div class="loader-sec" id = "most_popular_loader" style="display:none;">
            <div class="loader"></div>
            </div>
        <div id = "popular_prev_btn" style="display:none" class="card-slider-prev-btn"><i class="fas fa-chevron-left"></i></div>
         <div id = "popular_next_btn" style="display:none" class=" card-slider-next-btn"><i class="fas fa-chevron-right"></i></div>
         <ul id="most_popular_ul" class="card-slider-card-container owl-carousel owl-theme">

         </ul>
      </div>
   </section>
      <section class="card-slider-container">
      <div class="slider-heading">
      <h2 class="card-slider-title" style="">Top Rated Courses</h2>
      <a href="/courses?sort=rating">View All</a>
      </div>
      <div class="card-slider-courses">
            <div class="loader-sec" id = "top_rated_loader" style="display:none;">
            <div class="loader"></div>
            </div>
        <div id = "top_prev_btn" style="display:none" class="card-slider-prev-btn"><i class="fas fa-chevron-left"></i></div>
         <div id = "top_next_btn" style="display:none" class=" card-slider-next-btn" ><i class="fas fa-chevron-right"></i></div>
         <ul id = "top_rated_ul" class="card-slider-card-container owl-carousel owl-theme">

         </ul>
      </div>
   </section>
      <section class="card-slider-container">
      <div class="slider-heading">
      <h2 class="card-slider-title" style="">Free Courses</h2>
      <a href="/courses?mode=free">View All</a>
      </div>
      <div class="card-slider-courses">
            <div class="loader-sec" id = "free_courses_loader" style="display:none;">
            <div class="loader"></div>
            </div>
        <div id = "free_prev_btn" style="display:none" class="card-slider-prev-btn"><i class="fas fa-chevron-left"></i></div>
         <div id = "free_next_btn" style="display:none" class=" card-slider-next-btn"><i class="fas fa-chevron-right"></i></div>
         <ul id="free_courses_ul" class="card-slider-card-container owl-carousel owl-theme">

         </ul>
      </div>
   </section>
   <!-- to here -->
        %endif
        </div>


        % if course_discovery_enabled:
        <aside aria-label="${_('Refine Your Search')}" class="search-facets phone-menu">
          <h2 class="header-search-facets">${_('Refine Your Search')}</h2>
          <section class="search-facets-lists">
          </section>
        </aside>
        % endif

      </section>
    </section>
</main>

<!--Course Card slider JS -->
<script>
var popular_next_url;
var popular_prev_url;
var free_next_url;
var free_prev_url;
var top_next_url ;
var top_prev_url;
var recommended_next_url;
var recommended_prev_url;
var viewedSlider_pop = $('#most_popular_ul');
var viewedSlider_rec = $("#recommended_courses_ul");
var viewedSlider_free = $("#free_courses_ul");
var viewedSlider_top = $("#top_rated_ul");
$(document).ready(function() {

$('#rec_id').click(function() {

    window.location.href = window.location.protocol + "//" + window.location.host + "/courses?category=" + $("#user_industry").val();
    return false;
    %if show_categorized_view == True:
    show_categorized_view = False
    %endif
});


// Recommended Courses Slider Button
// From here
        if ($('#recommended_prev_btn').length) {
            var prev = $('#recommended_prev_btn');
            prev.on('click', function() {
                viewedSlider_rec.trigger('prev.owl.carousel');
                show_recommended_courses(recommended_prev_url);
                $('#recommended_prev_btn').show();
            });
        }
        if ($('#recommended_next_btn').length) {
            var next = $('#recommended_next_btn');
            next.on('click', function() {
                viewedSlider_rec.trigger('next.owl.carousel');
                show_recommended_courses(recommended_next_url);
                $('#recommended_next_btn').show();
            });
        }
// till here


// Most Popular Courses Slider Button
// From here

        if ($('#popular_prev_btn').length) {
            var prev = $('#popular_prev_btn');
            prev.on('click', function() {
                show_most_popular_courses(popular_prev_url);
                viewedSlider_pop.trigger('prev.owl.carousel');
                $('#popular_prev_btn').show();
            });
        }
        if ($('#popular_next_btn').length) {
            var next = $('#popular_next_btn');
            next.on('click', function() {
                show_most_popular_courses(popular_next_url);
                viewedSlider_pop.trigger('next.owl.carousel');
                $('#popular_next_btn').show();
            });
        }
// till here

// Free Courses Slider Button
// From here

        if ($('#free_prev_btn').length) {
        var prev = $('#free_prev_btn');
        prev.on('click', function() {
            viewedSlider_free.trigger('prev.owl.carousel');
            show_free_courses(free_prev_url);
            $('#free_prev_btn').show();
        });
        }
        if ($('#free_next_btn').length) {
            var next = $('#free_next_btn');
            next.on('click', function() {
                viewedSlider_free.trigger('next.owl.carousel');
                show_free_courses(free_next_url);
                $('#free_next_btn').show();
            });
        }

// till here

// Top Rated Courses Slider Button
// From here

        if ($('#top_prev_btn').length) {
            var prev = $('#top_prev_btn');
            prev.on('click', function() {
                show_top_rated_courses(top_prev_url);
                viewedSlider_top.trigger('prev.owl.carousel');
                $('#top_prev_btn').show()
            });
        }
        if ($('#top_next_btn').length) {
            var next = $('#top_next_btn');
            next.on('click', function() {
                show_top_rated_courses(top_next_url);

                viewedSlider_top.trigger('next.owl.carousel');
                $('#top_next_btn').show();
            });
        }
// till here

// generic slider button

    //if ($('.card-slider-card-container').length) {
        /*var viewedSlider = $('.card-slider-card-container');

        viewedSlider.owlCarousel({
            loop: false,
            margin: 20,
            autoplay: false,
            autoplayTimeout: 6000,
            dots: false,
            items: 4,
            // responsive:
            // {
            // 0:{items:1},
            // 575:{items:2},
            // 768:{items:3},
            // 991:{items:4},
            // 1199:{items:6}
            // }
        });



        if ($('.card-slider-prev-btn').length) {
            var prev = $('.card-slider-prev-btn');
            prev.on('click', function() {
                viewedSlider.trigger('prev.owl.carousel');
            });
        }

        if ($('.card-slider-next-btn').length) {
            var next = $('.card-slider-next-btn');
            next.on('click', function() {
                viewedSlider.trigger('next.owl.carousel');
                $('.card-slider-prev-btn').show();
            });
        }*/
    //}


// Till here
%if show_categorized_view:
    show_most_popular_courses(window.location.protocol + '//' + window.location.host + "/api/commerce/v2/web/courses/?platform_visibility=web&ordering=-enrollments_count&page=1&page_size=4");
    show_free_courses(window.location.protocol + '//' + window.location.host + "/api/commerce/v2/web/courses/?platform_visibility=web&sale_type=free&page=1&page_size=4");
    show_top_rated_courses(window.location.protocol + '//' + window.location.host + "/api/commerce/v2/web/courses/?platform_visibility=web&ordering=-ratings&page=1&page_size=4");
%if user.is_authenticated:
    show_recommended_courses(window.location.protocol + "//" + window.location.host + "/api/commerce/v2/web/courses/?platform_visibility=web&category=" + $("#user_industry").val() + "&page=1&page_size=4");
%endif
%endif


});




function show_most_popular_courses(target) {

//    popular_next_url = "http://edx.devstack.lms:18000/api/commerce/v2/web/courses/?platform_visibility=web&ordering=-enrollments_count&page=1&page_size=4";

    var form = new FormData();
    var settings = {
        "url": target,
        "method": "GET",
        "headers": {
            'X-CSRFToken': $('#web_csrf_token').val()
        },
        "processData": false,

        "contentType": false,
    };
    $("#most_popular_loader").css("display", "");

    $.ajax(settings).done(function(response) {
        $('#most_popular_ul').owlCarousel('destroy');
        $("#most_popular_ul").html('');
        $("#most_popular_loader").css("display", "None");
        console.log(response);
        if (response['status_code'] == 200) {
            $('#heading_recommended_courses').css('display', '')
            $('.courses-listing').empty()
        pagination_popular_url = response['result']['pagination']["next"];
        if( pagination_popular_url != null){
            $("#popular_next_btn").css("display","");
            popular_next_url = pagination_popular_url;
        }
        else {
            $("#popular_next_btn").css("display","None")
        }
        if(response['result']['pagination']["previous"] != null){
            $("#popular_prev_btn").css("display","");
            popular_prev_url = response['result']['pagination']["previous"];
        }
        else {
            $("#popular_prev_btn").css("display","None");
        }
            for (var i = 0; i < response['result']['results'].length; i++) {
                course_id = response['result']['results'][i]['course_number'];
                course_org = response['result']['results'][i]['organization'];
                course_code = response['result']['results'][i]['id'];
                course_name = response['result']['results'][i]['name'];
                course_image = response['result']['results'][i]["media"]['image']["raw"];
                course_difficulty_level = response['result']['results'][i]['difficulty_level'];
                course_enrollments_count = response['result']['results'][i]['enrollments_count'];
                course_ratings = response['result']['results'][i]['ratings'];
                course_ratings = course_ratings !== null ? course_ratings : "None";
                course_comments_count = response['result']['results'][i]['comments_count'];

                course_start = response['result']['results'][i]['start_date'];
                course_discount_applicable = response['result']['results'][i]['discount_applicable'];
                course_price = response['result']['results'][i]['modes'][0]['price'];
               /* if (course_price == 0) {
                    course_price = "Free" ;
                } else {
                    course_price = "S$" + course_price ;
                }*/
                course_discounted_price = response['result']['results'][i]['discounted_price'];
                course_discount_percentage = response['result']['results'][i]['discount_percentage'];
                course_discount_type = response['result']['results'][i]['discount_type'];

                var course = `<li class="card-slider-card-items owl-item">
               <article class="card-slider-course">
                  <a href="/courses/`+course_code+`/about">
                     <header class="card-slider-card-img-cont">
                        <div class="card-slider-card-cover-img">
                           <img src="` + course_image + `" alt="` + course_name + `">
                           <div class="card-slider-card-learn-more-btn" aria-hidden="true">LEARN MORE</div>
                        </div>
                     </header>
                     <div class="card-slider-card-course-info" aria-hidden="true">
                        <h2 class="crd-sldr-course-info ">
                           <span class="crd-sldr-course-info-org">` + course_org + `</span>
                           <span class="crd-sldr-course-info-code fl">` + course_id + `</span>
                           <span class="crd-sldr-course-info-title">` + course_name + `</span>
                           <p class="crd-sldr-course-info-label">Difficulty Level:<span class="course-difficulty_level">` + course_difficulty_level + `</span></p>
                           <p class="crd-sldr-course-info-label">Enrollment Count:<span class="course-enrollments_count">` + course_enrollments_count + `</span></p>
                           <p class="crd-sldr-course-info-label">Rating:<span class="course-ratings">` + course_ratings + `</span></p>
                           <p class="crd-sldr-course-info-label">Comments Count:<span class="course-comments_count">` + course_comments_count + `</span></p>

                           <div class="crd-sldr-course-info-price fl">
                              <ul>`
                                if (course_discount_applicable == true)
                                {
                                    if (course_discount_type == 'Percentage'){
                                 course +=`<li>Discount Percentage: <span class="main_price-percentage">`+course_discount_percentage+`%</span></li>`
                                 }
                                 else {
                                    course +=`<li>Discount: <span class="main_price-percentage">S$`+course_discount_percentage+`</span></li>`
                                 }

                                 course +=`<li>Price: <span class="crd-sldr-course-info-main-price main_price_cut">  ` + course_price + ` </span></li>
                                 <li>Discounted Price: <span class="main_price">S$`+course_discounted_price+`</span></li>`
                                }
                                else if (course_discount_applicable == false && course_price > 0 )
                                {

                                    course +=`<li>Price: <span class="main_price">S$`+course_price+`</span></li>`
                                }
                                else
                                {
                                    course +=`<li>Price: <span class="main_price">Free</span></li>`
                                }

                                course +=`

                              </ul>
                            </div>`

                           available_vouchers = response['result']['results'][i]['available_vouchers'];
                           if (available_vouchers.length > 0)
                                {
                                   course+=`<div class="coupon_details">`
                                  for (var j=0; j < available_vouchers.length; j++)
                                  {
                                        if (available_vouchers[j]["discount_type"] == 'Absolute')
                                        {

                                           course+= `<p><span class="coupen_code_value"><i class="fa fa-check"></i>`+ available_vouchers[j]["code"] +` -S$` + available_vouchers[j]["discount_value"]+`</span></p>`
                                        }
                                        else
                                        {

                                         course+=   `<p><span class="coupen_code_value"><i class="fa fa-check"></i>` +available_vouchers[j]["code"]+ ` -`+available_vouchers[j]["discount_value"]+`%</span></p>`
                                        }
                                    }
                            course+=`</div>`
                        }

                        course+=`</h2>
                        <div class="crd-sldr-course-info-date" aria-hidden="true" data-format="shortDate" data-datetime="2013-02-05T05:00:00+0000" data-language="en" data-string="Starts: {date}">Starts: ` + course_start + `</div>
                     </div>
                  </a>
               </article>
            </li>`;



                $("#most_popular_ul").append(course);

            }
        var viewedSlider_pop = $('#most_popular_ul');
        viewedSlider_pop.owlCarousel({
        loop: false,
        margin: 20,
        autoplay: false,
        autoplayTimeout: 6000,
        dots: false,
        items: 4,
        slideBy: 4,
        responsive:
        {
        0:{items:1},
        768:{items:2},
        991:{items:4}
        }
        });


        }
    });

}


function show_free_courses(target) {

    var form = new FormData();
    var settings = {
        "url": target,
        "method": "GET",
        "headers": {
            'X-CSRFToken': $('#web_csrf_token').val()
        },
        "processData": false,

        "contentType": false,
    };

    $("#free_courses_loader").css("display", "");
    $.ajax(settings).done(function(response) {
        $('#free_courses_ul').owlCarousel('destroy');
        $("#free_courses_ul").html('');
        $("#free_courses_loader").css("display", "None")
        console.log(response);
        if (response['status_code'] == 200) {
            $('#heading_recommended_courses').css('display', '');
            $('.courses-listing').empty();
        pagination_free_url = response['result']['pagination']["next"];
        if( pagination_free_url != null){
            $("#free_next_btn").css("display","");
            free_next_url = pagination_free_url;
        }
        else {
            $("#free_next_btn").css("display","None")
        }
           if(response['result']['pagination']["previous"] != null){
            $("#free_prev_btn").css("display","");
            free_prev_url = response['result']['pagination']["previous"];
        }
        else {
            $("#free_prev_btn").css("display","None")
        }
            for (var i = 0; i < response['result']['results'].length; i++) {
                course_id = response['result']['results'][i]['course_number'];
                course_org = response['result']['results'][i]['organization'];
                course_code = response['result']['results'][i]['id'];
                course_name = response['result']['results'][i]['name'];
                course_image = response['result']['results'][i]["media"]['image']["raw"];
                course_difficulty_level = response['result']['results'][i]['difficulty_level'];
                course_enrollments_count = response['result']['results'][i]['enrollments_count'];
                course_ratings = response['result']['results'][i]['ratings'];
                course_ratings = course_ratings !== null ? course_ratings : "None";
                course_comments_count = response['result']['results'][i]['comments_count'];

                course_start = response['result']['results'][i]['start_date'];
                course_discount_applicable = response['result']['results'][i]['discount_applicable'];
                course_price = response['result']['results'][i]['modes'][0]['price'];
                course_discount_type = response['result']['results'][i]['discount_type'];

                course_discounted_price = response['result']['results'][i]['discounted_price'];
                course_discount_percentage = response['result']['results'][i]['discount_percentage'];

                var course = `<li class="card-slider-card-items owl-item">
               <article class="card-slider-course">
                  <a href="/courses/`+course_code+`/about">
                     <header class="card-slider-card-img-cont">
                        <div class="card-slider-card-cover-img">
                           <img src="` + course_image + `" alt="` + course_name + `">
                           <div class="card-slider-card-learn-more-btn" aria-hidden="true">LEARN MORE</div>
                        </div>
                     </header>
                     <div class="card-slider-card-course-info" aria-hidden="true">
                        <h2 class="crd-sldr-course-info ">
                           <span class="crd-sldr-course-info-org">` + course_org + `</span>
                           <span class="crd-sldr-course-info-code fl">` + course_id + `</span>
                           <span class="crd-sldr-course-info-title">` + course_name + `</span>
                           <p class="crd-sldr-course-info-label">Difficulty Level:<span class="course-difficulty_level">` + course_difficulty_level + `</span></p>
                           <p class="crd-sldr-course-info-label">Enrollment Count:<span class="course-enrollments_count">` + course_enrollments_count + `</span></p>
                           <p class="crd-sldr-course-info-label">Rating:<span class="course-ratings">` + course_ratings + `</span></p>
                           <p class="crd-sldr-course-info-label">Comments Count:<span class="course-comments_count">` + course_comments_count + `</span></p>

                           <div class="crd-sldr-course-info-price fl">
                              <ul>`
                                if (course_discount_applicable == true)
                                {
                                    if (course_discount_type == 'Percentage'){
                                 course +=`<li>Discount Percentage: <span class="main_price-percentage">`+course_discount_percentage+`%</span></li>`
                                 }
                                 else {
                                    course +=`<li>Discount: <span class="main_price-percentage">S$`+course_discount_percentage+`</span></li>`
                                 }

                                 course +=`<li>Price: <span class="crd-sldr-course-info-main-price main_price_cut">  ` + course_price + ` </span></li>
                                 <li>Discounted Price: <span class="main_price">S$`+course_discounted_price+`</span></li>`
                                }
                                else if (course_discount_applicable == false && course_price > 0 )
                                {

                                    course +=`<li>Price: <span class="main_price">S$`+course_price+`</span></li>`
                                }
                                else
                                {
                                    course +=`<li>Price: <span class="main_price">Free</span></li>`
                                }

                                course +=`

                              </ul>
                           </div>`

                           available_vouchers = response['result']['results'][i]['available_vouchers'];
                           if (available_vouchers.length > 0)
                                {
                                   course+=`<div class="coupon_details">`
                                  for (var j=0; j < available_vouchers.length; j++)
                                  {
                                        if (available_vouchers[j]["discount_type"] == 'Absolute')
                                        {

                                           course+= `<p><span class="coupen_code_value"><i class="fa fa-check"></i>`+ available_vouchers[j]["code"] +` -S$` + available_vouchers[j]["discount_value"]+`</span></p>`
                                        }
                                        else
                                        {

                                         course+=   `<p><span class="coupen_code_value"><i class="fa fa-check"></i>` +available_vouchers[j]["code"]+ ` -`+available_vouchers[j]["discount_value"]+`%</span></p>`
                                        }
                                    }
                            course+=`</div>`
                        }

                        course+=`</h2>
                        <div class="crd-sldr-course-info-date" aria-hidden="true" data-format="shortDate" data-datetime="2013-02-05T05:00:00+0000" data-language="en" data-string="Starts: {date}">Starts: ` + course_start + `</div>
                     </div>
                  </a>
               </article>
            </li>`;



                $("#free_courses_ul").append(course)

            }

        var viewedSlider_free = $('#free_courses_ul');
        viewedSlider_free.owlCarousel({
        loop: false,
        margin: 20,
        autoplay: false,
        autoplayTimeout: 6000,
        dots: false,
        items: 4,
        slideBy: 4,
        responsive:
        {
        0:{items:1},
        768:{items:2},
        991:{items:4}
        }
        });

        }
    });

}

function show_top_rated_courses(top_rated) {

    var form = new FormData();
    var settings = {
        "url": top_rated,
        "method": "GET",
        "headers": {
            'X-CSRFToken': $('#web_csrf_token').val()
        },
        "processData": false,

        "contentType": false,
    };

    $("#top_rated_loader").css("display", "");
    $.ajax(settings).done(function(response) {
        $('#top_rated_ul').owlCarousel('destroy');
        $("#top_rated_ul").html('');
        $("#top_rated_loader").css("display", "None")
        console.log(response);
        if (response['status_code'] == 200) {
           // $('#heading_recommended_courses').css('display', '');
            $('.courses-listing').empty();
        pagination_top_url = response['result']['pagination']["next"];
        if( pagination_top_url != null){
            $("#top_next_btn").css("display","");
            top_next_url = pagination_top_url;
        }
        else {
            $("#top_next_btn").css("display","None");
        }
        if(response['result']['pagination']["previous"] != null){
            $("#top_prev_btn").css("display","");
            top_prev_url = response['result']['pagination']["previous"];
        }
        else {
            $("#top_prev_btn").css("display","None");
        }

            for (var i = 0; i < response['result']['results'].length; i++) {
                course_id = response['result']['results'][i]['course_number'];
                course_org = response['result']['results'][i]['organization'];
                course_code = response['result']['results'][i]['id'];
                course_name = response['result']['results'][i]['name'];
                course_image = response['result']['results'][i]["media"]['image']["raw"];
                course_difficulty_level = response['result']['results'][i]['difficulty_level'];
                course_enrollments_count = response['result']['results'][i]['enrollments_count'];
                course_ratings = response['result']['results'][i]['ratings'];
                course_ratings = course_ratings !== null ? course_ratings : "None";
                course_comments_count = response['result']['results'][i]['comments_count'];

                course_start = response['result']['results'][i]['start_date'];
                course_discount_applicable = response['result']['results'][i]['discount_applicable'];
                course_price = response['result']['results'][i]['modes'][0]['price'];
                course_discount_type = response['result']['results'][i]['discount_type'];
                /*                if (course_price == 0) {
                    course_price = "Free"
                } else {
                    course_price = "S$" + course_price
                }*/
                course_discounted_price = response['result']['results'][i]['discounted_price'];
                course_discount_percentage = response['result']['results'][i]['discount_percentage'];
                var course = `<li class="card-slider-card-items owl-item">
               <article class="card-slider-course">
                  <a href="/courses/`+course_code+`/about">
                     <header class="card-slider-card-img-cont">
                        <div class="card-slider-card-cover-img">
                           <img src="` + course_image + `" alt="` + course_name + `">
                           <div class="card-slider-card-learn-more-btn" aria-hidden="true">LEARN MORE</div>
                        </div>
                     </header>
                     <div class="card-slider-card-course-info" aria-hidden="true">
                        <h2 class="crd-sldr-course-info ">
                           <span class="crd-sldr-course-info-org">` + course_org + `</span>
                           <span class="crd-sldr-course-info-code fl">` + course_id + `</span>
                           <span class="crd-sldr-course-info-title">` + course_name + `</span>
                           <p class="crd-sldr-course-info-label">Difficulty Level:<span class="course-difficulty_level">` + course_difficulty_level + `</span></p>
                           <p class="crd-sldr-course-info-label">Enrollment Count:<span class="course-enrollments_count">` + course_enrollments_count + `</span></p>
                           <p class="crd-sldr-course-info-label">Rating:<span class="course-ratings">` + course_ratings + `</span></p>
                           <p class="crd-sldr-course-info-label">Comments Count:<span class="course-comments_count">` + course_comments_count + `</span></p>

                           <div class="crd-sldr-course-info-price fl">
                              <ul>`
                                if (course_discount_applicable == true)
                                {
                                    if (course_discount_type == 'Percentage'){
                                 course +=`<li>Discount Percentage: <span class="main_price-percentage">`+course_discount_percentage+`%</span></li>`
                                 }
                                 else {
                                    course +=`<li>Discount: <span class="main_price-percentage">S$`+course_discount_percentage+`</span></li>`
                                 }

                                 course +=`<li>Price: <span class="crd-sldr-course-info-main-price main_price_cut">  ` + course_price + ` </span></li>
                                 <li>Discounted Price: <span class="main_price">S$`+course_discounted_price+`</span></li>`
                                }
                                else if (course_discount_applicable == false && course_price > 0 )
                                {

                                    course +=`<li>Price: <span class="main_price">S$`+course_price+`</span></li>`
                                }
                                else
                                {
                                    course +=`<li>Price: <span class="main_price">Free</span></li>`
                                }

                                course +=`

                              </ul>
                           </div>`

                           available_vouchers = response['result']['results'][i]['available_vouchers'];
                           if (available_vouchers.length > 0)
                                {
                                   course+=`<div class="coupon_details">`
                                  for (var j=0; j < available_vouchers.length; j++)
                                  {
                                        if (available_vouchers[j]["discount_type"] == 'Absolute')
                                        {

                                           course+= `<p><span class="coupen_code_value"><i class="fa fa-check"></i>`+ available_vouchers[j]["code"] +` -S$` + available_vouchers[j]["discount_value"]+`</span></p>`
                                        }
                                        else
                                        {

                                         course+=   `<p><span class="coupen_code_value"><i class="fa fa-check"></i>` +available_vouchers[j]["code"]+ ` -`+available_vouchers[j]["discount_value"]+`%</span></p>`
                                        }
                                    }
                            course+=`</div>`
                        }

                        course+=`</h2>
                        <div class="crd-sldr-course-info-date" aria-hidden="true" data-format="shortDate" data-datetime="2013-02-05T05:00:00+0000" data-language="en" data-string="Starts: {date}">Starts: ` + course_start + `</div>
                     </div>
                  </a>
               </article>
            </li>`;


                $("#top_rated_ul").append(course)

            }

        var viewedSlider_top = $('#top_rated_ul');
        viewedSlider_top.owlCarousel({
        loop: false,
        margin: 20,
        autoplay: false,
        autoplayTimeout: 6000,
        dots: false,
        items: 4,
        slideBy: 4,
        responsive:
        {
        0:{items:1},
        768:{items:2},
        991:{items:4}
        }
        });

        }
    });

}

function show_recommended_courses(target) {

        var form = new FormData();
        var recommended_settings = {
        "url": target,
        "method": "GET",
        "headers": {
            'X-CSRFToken': $('#web_csrf_token').val()
        },
        "processData": false,

        "contentType": false,
    };

    $("#recommended_courses_loader").css("display", "");
    $.ajax(recommended_settings).done(function(response) {
        $('#recommended_courses_ul').owlCarousel('destroy');
        $("#recommended_courses_ul ").html('');
        $("#recommended_courses_loader").css("display", "None")
        if (response['status_code'] == 200) {
            $('#heading_recommended_courses').css('display', '')
            $('.courses-listing').empty()
            pagination_next_url = response['result']['pagination']["next"];

            if (pagination_next_url != null){
                $("#recommended_next_btn").css("display","");
                recommended_next_url = pagination_next_url;
            }
            else {
            $("#recommended_next_btn").css("display","None")
            }
            if (response['result']['pagination']['previous'] != null){
                $("#recommended_prev_btn").css("display","");
                recommended_prev_url = response['result']['pagination']['previous'];
            }
            else {
            $("#recommended_prev_btn").css("display","None");
            }


            for (var i = 0; i < response['result']['results'].length; i++) {
                course_id = response['result']['results'][i]['course_number'];
                course_org = response['result']['results'][i]['organization'];
                course_code = response['result']['results'][i]['id'];
                course_name = response['result']['results'][i]['name'];
                course_image = response['result']['results'][i]["media"]['image']["raw"];
                course_difficulty_level = response['result']['results'][i]['difficulty_level'];
                course_enrollments_count = response['result']['results'][i]['enrollments_count'];
                course_ratings = response['result']['results'][i]['ratings'];
                course_ratings = course_ratings !== null ? course_ratings : "None";
                course_comments_count = response['result']['results'][i]['comments_count'];

                course_start = response['result']['results'][i]['start_date'];
                course_discount_applicable = response['result']['results'][i]['discount_applicable'];
                course_price = response['result']['results'][i]['modes'][0]['price'];
                /*                if (course_price == 0) {
                    course_price = "Free"
                } else {
                    course_price = "S$" + course_price
                }*/
                course_discounted_price = response['result']['results'][i]['discounted_price'];
                course_discount_percentage = response['result']['results'][i]['discount_percentage'];
                available_vouchers = response['result']['results'][i]['available_vouchers'];
                course_discount_type = response['result']['results'][i]['discount_type'];

                var course = `<li class="card-slider-card-items owl-item">
               <article class="card-slider-course">
                  <a href="/courses/`+course_code+`/about">
                     <header class="card-slider-card-img-cont">
                        <div class="card-slider-card-cover-img">
                           <img src="` + course_image + `" alt="` + course_name + `">
                           <div class="card-slider-card-learn-more-btn" aria-hidden="true">LEARN MORE</div>
                        </div>
                     </header>
                     <div class="card-slider-card-course-info" aria-hidden="true">
                        <h2 class="crd-sldr-course-info ">
                           <span class="crd-sldr-course-info-org">` + course_org + `</span>
                           <span class="crd-sldr-course-info-code fl">` + course_id + `</span>
                           <span class="crd-sldr-course-info-title">` + course_name + `</span>
                           <p class="crd-sldr-course-info-label">Difficulty Level:<span class="course-difficulty_level">` + course_difficulty_level + `</span></p>
                           <p class="crd-sldr-course-info-label">Enrollment Count:<span class="course-enrollments_count">` + course_enrollments_count + `</span></p>
                           <p class="crd-sldr-course-info-label">Rating:<span class="course-ratings">` + course_ratings + `</span></p>
                           <p class="crd-sldr-course-info-label">Comments Count:<span class="course-comments_count">` + course_comments_count + `</span></p>

                           <div class="crd-sldr-course-info-price fl">
                              <ul>`
                                if (course_discount_applicable == true)
                                {
                                    if (course_discount_type == 'Percentage'){
                                 course +=`<li>Discount Percentage: <span class="main_price-percentage">`+course_discount_percentage+`%</span></li>`
                                 }
                                 else {
                                    course +=`<li>Discount: <span class="main_price-percentage">S$`+course_discount_percentage+`</span></li>`
                                 }

                                 course +=`<li>Price: <span class="crd-sldr-course-info-main-price main_price_cut">  ` + course_price + ` </span></li>
                                 <li>Discounted Price: <span class="main_price">S$`+course_discounted_price+`</span></li>`
                                }
                                else if (course_discount_applicable == false && course_price > 0 )
                                {

                                    course +=`<li>Price: <span class="main_price">S$`+course_price+`</span></li>`
                                }
                                else
                                {
                                    course +=`<li>Price: <span class="main_price">Free</span></li>`
                                }

                                course +=`

                              </ul>
                          </div>`

                           available_vouchers = response['result']['results'][i]['available_vouchers'];
                           if (available_vouchers.length > 0)
                                {
                                   course+=`<div class="coupon_details">`
                                  for (var j=0; j < available_vouchers.length; j++)
                                  {
                                        if (available_vouchers[j]["discount_type"] == 'Absolute')
                                        {

                                           course+= `<p><span class="coupen_code_value"><i class="fa fa-check"></i>`+ available_vouchers[j]["code"] +` -S$` + available_vouchers[j]["discount_value"]+`</span></p>`
                                        }
                                        else
                                        {

                                         course+=   `<p><span class="coupen_code_value"><i class="fa fa-check"></i>` +available_vouchers[j]["code"]+ ` -`+available_vouchers[j]["discount_value"]+`%</span></p>`
                                        }
                                    }
                            course+=`</div>`
                        }

                        course+=`</h2>
                        <div class="crd-sldr-course-info-date" aria-hidden="true" data-format="shortDate" data-datetime="2013-02-05T05:00:00+0000" data-language="en" data-string="Starts: {date}">Starts: ` + course_start + `</div>
                     </div>
                  </a>
               </article>
            </li>`;


                $("#recommended_courses_ul").append(course)

            }
            var viewedSlider_rec = $('#recommended_courses_ul');

            viewedSlider_rec.owlCarousel({
                loop: false,
                margin: 20,
                autoplay: false,
                autoplayTimeout: 6000,
                dots: false,
                items: 4,
                slideBy: 4,
                responsive:
                {
                0:{items:1},
                768:{items:2},
                991:{items:4}
                }
        });


        }
    });

}


</script>
